<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giỏ Hàng - 1NT3Rnet</title>
    <link rel="stylesheet" href="style_user.css">
    <link rel="stylesheet" href="style_cart.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script>
// Kiểm tra đăng nhập khi trang load
document.addEventListener('DOMContentLoaded', function() {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    
    // Nếu chưa đăng nhập, chuyển đến unlog.html
    if (!currentUser) {
        window.location.href = 'unlog.html';
        return;
    }
    
    // Nếu là admin, chuyển đến index.html
    if (currentUser.role === 'admin') {
        window.location.href = 'index.html';
        return;
    }
});
</script>
</head>
<body>
    <header>
        <div class="header-container">
            <h1 class="logo">1NT3Rnet</h1>
            <nav class="main-nav">
            </nav>
            <div class="header-right">
                <div class="user-info" id="userInfo"></div>
                <a href="cart.html" class="cart-icon">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </a>
            </div>
        </div>
    </header>

    <div class="cart-container">
        <h1>Giỏ Hàng Của Bạn</h1>
        
        <div class="cart-content">
            <div class="cart-items" id="cartItems">
                <!-- Danh sách sản phẩm sẽ được hiển thị ở đây -->
            </div>
            
            <div class="cart-summary">
                <h3>Tổng Cộng</h3>
                <div class="summary-details">
                    <div class="summary-row">
                        <span>Tạm tính:</span>
                        <span id="subtotal">0₫</span>
                    </div>
                    <div class="summary-row">
                        <span>Phí vận chuyển:</span>
                        <span>30.000₫</span>
                    </div>
                    <div class="summary-row total">
                        <span>Tổng cộng:</span>
                        <span id="total">0₫</span>
                    </div>
                </div>
                <button class="checkout-btn" id="checkoutBtn">Tiến Hành Thanh Toán</button>
                <button class="continue-shopping" onclick="window.location.href='index_user.html'">
                    Tiếp Tục Mua Sắm
                </button>
            </div>
        </div>
        
        <div class="empty-cart" id="emptyCart">
            <i class="fas fa-shopping-cart"></i>
            <h2>Giỏ hàng của bạn đang trống</h2>
            <p>Hãy thêm một số sản phẩm vào giỏ hàng!</p>
            <button class="continue-shopping" onclick="window.location.href='index_user.html'">
                Mua Sắm Ngay
            </button>
        </div>
    </div>

    <script>
        // Script xử lý user info
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const userInfo = document.getElementById('userInfo');
            
            if (currentUser) {
                userInfo.innerHTML = `
                    <div class="user-welcome">
                        <span class="welcome-text">Xin chào,</span>
                        <span class="username">${currentUser.username}</span>
                    </div>
                    <button class="logout-btn">Đăng xuất</button>
                `;
                
                document.querySelector('.logout-btn').addEventListener('click', function() {
                    localStorage.removeItem('currentUser');
                    window.location.href = 'index_user.html';
                });
            } else {
                userInfo.innerHTML = `
                    <div class="auth-buttons">
                        <button class="auth-btn login-btn">Đăng nhập</button>
                        <button class="auth-btn register-btn">Đăng ký</button>
                    </div>
                `;
                
                document.querySelector('.login-btn').addEventListener('click', function() {
                    window.location.href = 'login.html';
                });
                
                document.querySelector('.register-btn').addEventListener('click', function() {
                    window.location.href = 'register.html';
                });
            }
            
            // Load giỏ hàng
            loadCart();
        });

        // Tải và hiển thị giỏ hàng
        function loadCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartItemsContainer = document.getElementById('cartItems');
            const emptyCart = document.getElementById('emptyCart');
            const cartContent = document.querySelector('.cart-content');
            
            if (cart.length === 0) {
                cartContent.style.display = 'none';
                emptyCart.style.display = 'block';
                return;
            }
            
            cartContent.style.display = 'flex';
            emptyCart.style.display = 'none';
            
            cartItemsContainer.innerHTML = '';
            
            cart.forEach((item, index) => {
                const cartItem = createCartItemElement(item, index);
                cartItemsContainer.appendChild(cartItem);
            });
            
            updateCartSummary();
        }

        // Tạo phần tử HTML cho mỗi sản phẩm trong giỏ hàng
        function createCartItemElement(item, index) {
            const cartItem = document.createElement('div');
            cartItem.className = 'cart-item';
            cartItem.innerHTML = `
                <img src="${item.image}" alt="${item.name}" class="cart-item-image">
                <div class="cart-item-details">
                    <div class="cart-item-name">${item.name}</div>
                    <div class="cart-item-price">${formatPrice(item.price)}₫</div>
                    <div class="cart-item-actions">
                        <div class="quantity-controls">
                            <button class="quantity-btn minus-btn" onclick="decreaseQuantity(${index})">-</button>
                            <input type="text" class="quantity-input" value="${item.quantity}" readonly>
                            <button class="quantity-btn plus-btn" onclick="increaseQuantity(${index})">+</button>
                        </div>
                        <button class="remove-btn" onclick="removeOneItem(${index})">
                            Xóa 1 SP
                        </button>
                        <button class="remove-all-btn" onclick="removeAllItems(${index})">
                            Xóa Tất Cả
                        </button>
                    </div>
                </div>
            `;
            
            return cartItem;
        }

        // Giảm số lượng sản phẩm
        function decreaseQuantity(index) {
            let cart = JSON.parse(localStorage.getItem('cart'));
            
            if (cart[index].quantity > 1) {
                cart[index].quantity -= 1;
            } else {
                cart.splice(index, 1);
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCart();
            updateCartCount();
        }

        // Tăng số lượng sản phẩm
        function increaseQuantity(index) {
            let cart = JSON.parse(localStorage.getItem('cart'));
            cart[index].quantity += 1;
            
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCart();
            updateCartCount();
        }

        // Xóa 1 sản phẩm
        function removeOneItem(index) {
            let cart = JSON.parse(localStorage.getItem('cart'));
            
            if (cart[index].quantity > 1) {
                cart[index].quantity -= 1;
            } else {
                cart.splice(index, 1);
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCart();
            updateCartCount();
        }

        // Xóa toàn bộ sản phẩm
        function removeAllItems(index) {
            let cart = JSON.parse(localStorage.getItem('cart'));
            cart.splice(index, 1);
            
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCart();
            updateCartCount();
        }

        // Cập nhật tổng tiền
        function updateCartSummary() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            const shipping = 30000;
            const total = subtotal + shipping;
            
            document.getElementById('subtotal').textContent = formatPrice(subtotal) + '₫';
            document.getElementById('total').textContent = formatPrice(total) + '₫';
        }

        // Định dạng giá tiền
        function formatPrice(price) {
            return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        // Cập nhật số lượng trên icon giỏ hàng
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartCount = cart.reduce((total, item) => total + item.quantity, 0);
            
            const cartCountElements = document.querySelectorAll('.cart-count');
            cartCountElements.forEach(element => {
                element.textContent = cartCount;
            });
        }

        // Cập nhật cart count khi trang load
        updateCartCount();
    </script>
</body>
</html>